#include <stdio.h>
#include <stdlib.h>

#include "goesct2.h"
#include "goesct3.h"

#define PI 3.1415926
doublereal rad2deg(doublereal angle) {
	return 180.0 * angle / PI;
}


int main(int argc, char** argv) {

	if (argc != 3) {
	   printf("Usage: executable line pixel\n");
	   exit(0);
	}
	
	real pixel = atof(argv[2]);
	real line = atof(argv[1]);
	printf("line = %f pixel = %f\n", line, pixel);

	extern double one_rec[];
	doublereal* rec = one_rec;

	integer flipflag;   // 1=normal    -1=inverted
	integer imc;          // 1=disaled 0=enabled
	integer instr;       // 1=imager   2=sounder

	real Pixel[2][2][2];
	real Line[2][2][2];
	int flipflagIndex;
	int imcIndex;
	int instrIndex;

	Pixel[0][0][0] =  10405.39;
	Line[0][0][0] = 3487.36;
	Pixel[0][0][1] =  1162.99;
	Line[0][0][1] = 1219.35;
	Pixel[0][1][0] =  10282.76;
	Line[0][1][0] = 3626.88;
	Pixel[0][1][1] =  1152.22;
	Line[0][1][1] = 1238.93;

	Pixel[1][0][0] =  10405.39;
	Line[1][0][0] = 3487.36;
	Pixel[1][0][1] =  1162.87;
	Line[1][0][1] = 1219.41;
	Pixel[1][1][0] =  10267.15;
	Line[1][1][0] = 3617.92;
	Pixel[1][1][1] =  1151.16;
	Line[1][1][1] = 1238.05;
	
	doublereal subsat_lat;
	doublereal subsat_lon;
	doublereal time;
	doublereal epoch;
	int model;
	real elev;
	real scan;
	real rrlat;
	real rrlon;
	integer ierr;
	
	
	/*** set constants ***/
	setcons(4,3068,2,3068,4,1402,2,1402);

	/*** compute epoch time ***/
	epoch= timex(1994,299,00,00,0.0);
	//epoch= (float)20557829.57612;
	time=  timex(1994,299,16,05,0.0);
	//time=  epoch + (float)20.;


	for (flipflag = 1; flipflag >= -1; flipflag -=2) {
	    if (flipflag ==1) 
	       flipflagIndex = 1;
	    else 
	       flipflagIndex = 0;

	    for (imc = 0; imc <=1; imc++) {
	        imcIndex = imc;
		model = lmodel(time,epoch,rec,imc, &subsat_lat, &subsat_lon);
	        
		for (instr = 1; instr <=2; instr++) {
		    instrIndex = instr - 1; 

	            printf("instr = %d, flipflag = %d, imc = %d\n\n", 
			 instr, flipflag, imc);

		    line = Line[flipflagIndex][imcIndex][instrIndex];
		    pixel = Pixel[flipflagIndex][imcIndex][instrIndex];
		    
                    /*** CONVERT Line/pixel to N-S AND E-W INSTRUMENT angles ***/
                    printf("LINE/PIXEL TO LAT/LON TRANSFORMATION: \n");
                    printf("     Line= %f  Pixel= %f \n", line, pixel);

		    elev = (real) evln_(&instr,&line);
		    scan = (real) scpx_(&instr,&pixel);
                    printf("     elev= %f  scan= %f \n", elev, scan);
                    printf("    dE= %f dS= %f \n", rad2deg(elev), rad2deg(scan));

		    /*** TRANSFORM N-S and E-W angles TO GEOGRAPHIC COORDINATES ***/
                    lpoint_(&instr, &flipflag, &elev, &scan, &rrlat, &rrlon, &ierr);
                            
        	    // ierr = 21;
		    printf("err = %ld\n", ierr);
                    if (ierr== 0) {
                        printf("     RRLAT= %f  RRLON= %f \n", rrlat, rrlon);
                        printf("     DLAT= %f  DLON= %f \n", rad2deg(rrlat), rad2deg(rrlon));
                    }


		} 
	    }

	}


	//printf("sizeof(doublereal) = %d\n", sizeof(doublereal) );
	//printf("sizeof(real) = %d\n", sizeof(real) );

 	//doublereal tu;
	//tu = time50(rec[12]);


        //rlat = 0.872665;
	//rlon= -2.617994; 
	//rrlat = (real) rlat;
	//rrlon = (real) rlon;
	//printf("rrlat = %f   rrlon = %f\n", rrlat, rrlon);
	//ierr = pl2ll(instr, flipflag, pixel, line, &rlat, &rlon);
	
	return 0;
}	

doublereal one_rec[] = {
          0.00000000,
          0.00000000,
          0.00000000,
          0.00000000,
         -1.74740505,
         84.06604004,
         -0.03436849,
         -0.00610298,
          0.00000000,
          0.00000000,
          0.00000000,
  428409632.00000000,
 1653818727.00000000,
          0.00000000,
          0.00030000,
         -0.00030000,
         -0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00020000,
          0.00436300,
          0.00000000,
          0.00050000,
        100.00000000,
          0.00200000,
         15.00000000,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          4.00000000,
          2.00000000,
          2.00000000,
          0.00001000,
          0.00000000,
          0.01000000,
          2.00000000,
          3.00000000,
         -0.00001000,
          0.00000000,
          0.01000000,
          3.00000000,
          2.00000000,
          0.00001000,
          0.00000000,
          0.01000000,
          3.00000000,
          3.00000000,
         -0.00001000,
          0.00000000,
          0.01000000,
          0.00050000,
        100.00000000,
          0.00200000,
         15.00000000,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          4.00000000,
          2.00000000,
          2.00000000,
          0.00001000,
          0.00000000,
          0.01000000,
          2.00000000,
          3.00000000,
         -0.00001000,
          0.00000000,
          0.01000000,
          3.00000000,
          2.00000000,
          0.00001000,
          0.00000000,
          0.01000000,
          3.00000000,
          3.00000000,
         -0.00001000,
          0.00000000,
          0.01000000,
          0.00050000,
        100.00000000,
          0.00100000,
         15.00000000,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          4.00000000,
          2.00000000,
          2.00000000,
          0.00001000,
          0.00000000,
          0.01000000,
          2.00000000,
          3.00000000,
         -0.00001000,
          0.00000000,
          0.01000000,
          3.00000000,
          2.00000000,
          0.00001000,
          0.00000000,
          0.01000000,
          3.00000000,
          3.00000000,
         -0.00001000,
          0.00000000,
          0.01000000,
         -0.00005000,
         10.00000000,
          0.00100000,
         15.00000000,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          4.00000000,
          2.00000000,
          2.00000000,
          0.00001000,
          0.00000000,
          0.01000000,
          2.00000000,
          3.00000000,
         -0.00001000,
          0.00000000,
          0.01000000,
          3.00000000,
          2.00000000,
          0.00001000,
          0.00000000,
          0.01000000,
          3.00000000,
          3.00000000,
         -0.00001000,
          0.00000000,
          0.01000000,
         -0.00005000,
         10.00000000,
          0.00100000,
         15.00000000,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          0.00000500,
          4.00000000,
          2.00000000,
          2.00000000,
          0.00001000,
          0.00000000,
          0.01000000,
          2.00000000,
          3.00000000,
         -0.00001000,
          0.00000000,
          0.01000000,
          3.00000000,
          2.00000000,
          0.00001000,
          0.00000000,
          0.01000000,
          3.00000000,
          3.00000000,
         -0.00001000,
          0.00000000,
          0.01000000
};
